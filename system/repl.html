<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Interacting with the REPL - OMPAS Documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../ompas.html"><strong aria-hidden="true">1.</strong> Operational Model Planning and Acting System (OMPAS)</a></li><li class="chapter-item expanded "><a href="../run.html"><strong aria-hidden="true">2.</strong> How to run the system</a></li><li class="chapter-item expanded "><a href="../system/intro.html"><strong aria-hidden="true">3.</strong> Acting System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../system/repl.html" class="active"><strong aria-hidden="true">3.1.</strong> Interacting with the REPL</a></li><li class="chapter-item expanded "><a href="../system/configuration.html"><strong aria-hidden="true">3.2.</strong> Configuring OMPAS</a></li></ol></li><li class="chapter-item expanded "><a href="../language/al.html"><strong aria-hidden="true">4.</strong> Acting Language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../language/scheme/intro.html"><strong aria-hidden="true">4.1.</strong> Scheme</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../language/scheme/modules/intro.html"><strong aria-hidden="true">4.1.1.</strong> Modules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../language/scheme/modules/module-io.html"><strong aria-hidden="true">4.1.1.1.</strong> Module IO</a></li><li class="chapter-item expanded "><a href="../language/scheme/modules/module-string.html"><strong aria-hidden="true">4.1.1.2.</strong> Module String</a></li><li class="chapter-item expanded "><a href="../language/scheme/modules/module-utils.html"><strong aria-hidden="true">4.1.1.3.</strong> Module Utils</a></li><li class="chapter-item expanded "><a href="../language/scheme/modules/module-advanced-math.html"><strong aria-hidden="true">4.1.1.4.</strong> Module Advanced math</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../language/primitives.html"><strong aria-hidden="true">4.2.</strong> Acting primitives</a></li><li class="chapter-item expanded "><a href="../language/resources.html"><strong aria-hidden="true">4.3.</strong> Resource management</a></li><li class="chapter-item expanded "><a href="../language/advanced.html"><strong aria-hidden="true">4.4.</strong> Advanced acting functions</a></li></ol></li><li class="chapter-item expanded "><a href="../gobot-sim/intro.html"><strong aria-hidden="true">5.</strong> Gobot-Sim</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OMPAS Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="interacting-with-the-repl"><a class="header" href="#interacting-with-the-repl">Interacting with the REPL</a></h1>
<p>REPL stands for <strong>Read Evaluate Print Loop</strong>, which means raw expressions are sent to an interpreter which it will execute in real-time without prior compilation.
Such systems are born with Lisp, and the most common language using this feature is Python.
The present system proposes a number of primitives to interact with the system.</p>
<hr />
<h2 id="monitor"><a class="header" href="#monitor">Monitor</a></h2>
<h3 id="principal-functions"><a class="header" href="#principal-functions">Principal functions</a></h3>
<ul>
<li>
<p><code>(launch)</code> launches RAE. It will also launch the platform if defined.</p>
</li>
<li>
<p><code>(stop)</code> stops RAE.</p>
</li>
<li>
<p><code>(configure-platform e1...en)</code> A number of parameters passed to the platform when launched.</p>
</li>
<li>
<p><code>(set-select &lt;select-mode&gt;)</code> configure the algorithm that will be used to select a method during the refinement process.
The available select-mode are <em>greedy</em>, <em>planning</em>, <em>aries</em>, <em>aries-opt</em>, <em>rae-plan</em>, <em>c-choice</em>, <em>upom</em> (not yet implemented).</p>
</li>
<li>
<p><code>(trigger-task &lt;label&gt; &lt;params&gt;)</code> trigger a task with instantiated parameters. Launch before triggering tasks.</p>
</li>
<li>
<p><code>(add-task-to-execute &lt;label&gt; &lt;params)</code> define a task to execute before the launch of RAE. The task will be passed to RAE once the acting system is launched.</p>
</li>
</ul>
<h3 id="monitoring"><a class="header" href="#monitoring">Monitoring</a></h3>
<ul>
<li><code>(get-state)</code> returns the whole state of RAE. Contains only initial facts if RAE is not launched yet.</li>
<li><code>(get-resources)</code> returns the list of resources with some useful information, as the number of waiter for each resource.</li>
<li><code>(get-monitors)</code> returns the list of dynamic expressions actually monitored.</li>
<li><code>(get-env)</code> returns the environment of RAE.</li>
<li><code>(get-methods)</code> returns the list of methods defined.</li>
<li><code>(get-state-functions)</code> returns the list of state-function.</li>
<li><code>(get-tasks)</code> returns the list of tasks.</li>
<li><code>(get-config-platform)</code> returns the config of the platform.</li>
<li><code>(get-select)</code> returns the select mode used by RAE.</li>
<li><code>(get-agenda &lt;type&gt; &lt;status&gt;)</code> returns the status of all tasks and commands executed in RAE. The list can be sorted by <strong>type</strong> (task, command) or/and <strong>status</strong> (pending, running, done, failure).</li>
<li><code>(get-task-network)</code> returns the network of tasks and commands.</li>
<li><code>(get-type-hierarchy)</code> returns the type hierarchy.</li>
<li><code>(get-stats)</code> returns a bunch of statistics on the current RAE run.</li>
<li><code>(export-stats &lt;csv-file&gt;)</code> exports the stats in a <em>csv</em> file.</li>
</ul>
<h3 id="operational-model-extraction"><a class="header" href="#operational-model-extraction">Operational model extraction</a></h3>
<p>Those functions are used to test and debug the extraction of planning models in the form of chronicles from the automated analysis of the method operational models and the command models. The planner used is Aries @@godetChroniclesRepresentingHierarchical2022, the project is available here : <a href="https://github.com/plaans/aries">https://github.com/plaans/aries</a></p>
<ul>
<li><code>(convert-expr e)</code> converts the expression <em>e</em> into a chronicle and prints it.</li>
<li><code>(convert-domain)</code> converts the domain and prints it.</li>
<li><code>(plan-task t p1...pn)</code> converts the domain and calls the planner <em>aries</em> </li>
</ul>
<hr />
<h2 id="domain-definition"><a class="header" href="#domain-definition">Domain definition</a></h2>
<h3 id="commands"><a class="header" href="#commands"><strong>Commands</strong></a></h3>
<p>Commands are defined with the macro <code>def-command</code> that takes a symbol, and a list of typed parameters.</p>
<pre><code class="language-lisp">(def-command pick (:params (?obj ball) (?room room) (?gripper gripper)))
</code></pre>
<p>A model can be provided and defined with the macro <code>def-command-pddl-model</code>. Here is an example for the command <em>pick</em>. The pre-conditions takes a list of dynamic expressions (expressions which result will depend on the current values of state-variables).</p>
<pre><code class="language-lisp">(def-command-pddl-model pick
    (:params (?obj ball) (?room room) (?gripper gripper))
    (:pre-conditions
        (= (at ?obj) ?room)
        (= (at-robby) ?room)
        (= (carry ?gripper) no_ball))
    (:effects
        ('carry ?gripper) ?obj)
        ('at ?obj no_place)))
</code></pre>
<!--- This function creates a lambda that will be stored in the environment with this form:

```lisp
(lambda (?r) (rae-exec-command (quote pick) ?r))
```
-->
<h3 id="tasks"><a class="header" href="#tasks"><strong>Tasks</strong></a></h3>
<p>A task is defined with the macro <code>def-task</code> that takes a label, and a list of typed parameters.</p>
<pre><code class="language-lisp">(def-task pick-and-drop (:params (?ball ball) (?room room)))
</code></pre>
<h3 id="methods"><a class="header" href="#methods"><strong>Methods</strong></a></h3>
<p>A method is defined with the macro <code>def-method</code> that takes a label, the task it refines, a list of typed parameters, the first ones inherited from the task, a score to sort the method for the basic select of RAE, and the body that is the program executed by the platform is the method is selected.</p>
<pre><code class="language-lisp">(def-method m1
    (:task pick-and-drop)
    (:params (?ball ball) (?room room) (?gripper gripper) (?departure room))
    (:pre-conditions 
        (= (at ?ball) (at-robby))
        (= (carry ?gripper) no_ball)
        (= ?departure (at-robby)))
    (:score 0)
    (:body
        (do
            (pick ?ball ?departure ?gripper)
            (move ?departure ?room)
            (drop ?ball ?room ?gripper))))

</code></pre>
<p><strong>State-function</strong></p>
<p>A state function returns the value of state-variable at a given time.
We define a state function with the macro <code>def-state-function</code> that takes a label, a list of typed parameters, and a result type.</p>
<pre><code class="language-lisp">(def-state-function at (:params (?b ball)) (:result room))
</code></pre>
<h3 id="lambdas"><a class="header" href="#lambdas"><strong>Lambdas</strong></a></h3>
<p>Lambdas can be defined in the evaluation environment of RAE, which is different from the environment of the REPL. A lambda is defined with the macro <code>def-lambda</code> that takes the label of the lambda, and a lambda.</p>
<pre><code class="language-lisp">(def-lambda go_random
    (lambda (?r ?l ?u)
        (let ((x (rand-int-in-range ?l ?u))
                (y (rand-int-in-range ?l ?u)))
                (navigate_to ?r x y))))
</code></pre>
<h3 id="types"><a class="header" href="#types"><strong>Types</strong></a></h3>
<p>The system supports the definition of new types, with a hierarchy of types. A type is defined with the macro <code>def-types</code> that takes a list of types.</p>
<pre><code class="language-lisp">;adding new root types
(def-types room gripper ball)
;adding a new subtype to ball
(def-types (football ball))
</code></pre>
<h3 id="objects"><a class="header" href="#objects"><strong>Objects</strong></a></h3>
<p>Typed objects can be defined in the fact base of the system, in particular when using the system in simulation.
We use the macro <code>def-objects</code> that takes lists of objects with their type defined as the last element of the list.</p>
<pre><code class="language-lisp"> (def-objects
    (bedroom kitchen living_room room)
    (b1 b2 b3 b4 ball))
</code></pre>
<h3 id="initial-state"><a class="header" href="#initial-state"><strong>Initial-state</strong></a></h3>
<p>To define an initial-state for some scenarios (for example to use RAE in simulation), we use the macro <code>def-initial-state</code> that takes a list of pair &lt;key,value&gt;.</p>
<pre><code class="language-lisp">(def-initial-state
    (at-robby living_room)
    ((at b1) bedroom)
    ((at b2) bedroom)
    ((at b3) bedroom)
    ((at b4) bedroom)
    ((carry left) no_ball)
    ((carry right) no_ball))
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../system/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../system/configuration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../system/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../system/configuration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
